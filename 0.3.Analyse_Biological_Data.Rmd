---
title: "Analyse Biological Data"
author: "Gerard Temprano Sagrera"
date: "17/11/2022"
output: html_document
---

```{r, warning=FALSE, message=FALSE, echo = FALSE}
library(openxlsx);library(ggplot2);library(corrplot);library(ggpubr)
```

```{r}
bio <- read.xlsx("C://Users/Gerard/Desktop/AAA/RNAseq/20221115_Datos Pacientes.xlsx")
bio <- bio[2:nrow(bio),]
bio$SEXO <- ifelse(bio$SEXO == 1, "Man","Woman")
```

```{r}
cases <- bio[bio$Status == "Case",]
controls <- bio[bio$Status == "Control",]
```

```{r}
cases2 <- cases[,7:ncol(cases)]
```

```{r}
#cases2[rowSums(is.na(cases2)) > 6,]
```

```{r}
#colSums(is.na(bio))
```

1.  Only sample, status, sex and age have no NAs.
2.  Cases only: Type, Symptomatic, Height, Weight, PAD, Other Aneurysm, Aortic Diameter, Leucocytes, Neutrophiles, Limphocytes, Monocytes, Platalets, Hb, RDW.
3.  Controls only: Pathology.

Which column would be word to try to complete?


## Correlation study:

### All with no NAs:

```{r}
bio.na <- bio[, colSums(is.na(bio))==0]

bio.na <- bio.na[,2:ncol(bio.na)]

# Transform to numeric:
bio.na$Status <- as.numeric(as.factor(bio.na$Status))
bio.na$SEXO <- as.numeric(as.factor(bio.na$SEXO))

bio.na <- as.data.frame(lapply(bio.na, as.numeric))
```

### All:

```{r, warning=FALSE}
# Select columns:
bio2 <- bio[,2:ncol(bio)]
bio2 <- bio2[,c("Status","SEXO","age","TIPOANEURISMA","symptomatic","Height_cm","Weight_Kg","Smoking","other_aneurysm",
                "aortc_diameter_mm")]

# Transform to numeric:
bio2$Status <- as.numeric(as.factor(bio2$Status))
bio2$SEXO <- as.numeric(as.factor(bio2$SEXO))

# Remove pathology:
bio2 <- bio2[ , !names(bio2) %in% c("Pathology")]

bio2 <- as.data.frame(lapply(bio2, as.numeric))
```


```{r}
M <- cor(bio2, use = "complete.obs")
testRes <- cor.mtest(bio2, conf.level = 0.95)

M[is.na(M)] <- 0
testRes$p[is.na(testRes$p)] <- 1

pdf(file = "C://Users/Gerard/Desktop/AAA/RNAseq/GitHub/Correaltion_Plot_All.pdf")
corrplot(M, p.mat = testRes$p, sig.level = 0.05, type = "lower", insig = "blank")
dev.off()
```

- Type of aneurysm, height, weight, other aneurysm and size are only available for cases, thus are linked to the status.

- Status is correlated with sex and age.


## Cases:

```{r}
cases <- bio2[1:97,]
cases <- cases[,2:ncol(cases)]
```

```{r}
M <- cor(cases, use = "complete.obs")
testRes <- cor.mtest(cases, conf.level = 0.95)

M[is.na(M)] <- 0
testRes$p[is.na(testRes$p)] <- 1

pdf(file = "C://Users/Gerard/Desktop/AAA/RNAseq/GitHub/Correaltion_Plot_Cases.pdf")
corrplot(M, p.mat = testRes$p, sig.level = 0.05, type = "lower", insig = "blank")
dev.off()
```

## Controls:

```{r}
controls <- bio2[98:nrow(bio2),]
controls <- controls[,2:ncol(controls)]
controls <- controls[,c("SEXO","age","Smoking")]
```

```{r, warning=FALSE}
M <- cor(controls, use = "complete.obs")
testRes <- cor.mtest(controls, conf.level = 0.95)

M[is.na(M)] <- 0
testRes$p[is.na(testRes$p)] <- 1

pdf(file = "C://Users/Gerard/Desktop/AAA/RNAseq/GitHub/Correaltion_Plot_Controls.pdf")
corrplot(M, p.mat = testRes$p, sig.level = 0.05, type = "lower", insig = "blank")
dev.off()
```


### Sex by Status:
```{r}
t.test(as.numeric(as.factor(bio$SEXO)) ~ as.numeric(as.factor(Status)), data=bio)
```

There are clearly more males among controls than among cases.


### Age by Status:
```{r}
ggboxplot(bio, x = "Status", y = "age") +
  geom_boxplot() +
  stat_compare_means(method = "t.test")
```


### Aneurysm diameter against Height:

```{r, warning=FALSE}
ggscatter(cases, x = "aortc_diameter_mm", y = "Height_cm",
          add = "reg.line") +
  stat_cor(method = "pearson")
```

### Aneurysm diameter against Weight:

```{r, warning=FALSE}
ggscatter(cases, x = "aortc_diameter_mm", y = "Weight_Kg",
          add = "reg.line") +
  stat_cor(method = "pearson")
```

### Aneurysm diameter against Sex:

```{r, warning=FALSE}
ggplot(data = bio, aes(x = SEXO, y = aortc_diameter_mm)) +
  geom_boxplot()
```

### Aneurysm diameter against Age:

```{r, warning=FALSE}
ggscatter(cases, x = "aortc_diameter_mm", y = "age",
          add = "reg.line") +
  stat_cor(method = "pearson")
```

### Type of Aneurysm against diameter:

```{r}
ggboxplot(subset(bio, !is.na(TIPOANEURISMA)), x = "TIPOANEURISMA", y = "aortc_diameter_mm") +
  geom_boxplot() +
  stat_compare_means(method = "t.test")
```









### Aneurysm type (Cases only):

```{r}
table(cases$TIPOANEURISMA, useNA = "always")
```

Among cases, there are 27 NAs

### Pathology (Controls only):

```{r}
#table(controls$Pathology, useNA = "always")
```

### Symptomatic (Cases only):

```{r}
table(cases$symptomatic, useNA = "always")
```

There are only 5 sympromatic aneurysms among cases.

Controls don't have information about Height or Weight.

### Height (Cases only):

```{r}
sum(is.na(cases$Height_cm))

17/nrow(cases)*100
```

```{r}
range(cases$Height_cm, na.rm = T)
```

```{r}
ggplot(cases, aes(Height_cm)) + geom_density()
```

There are 17 cases with no Height information.

### Weight (Cases only):

```{r}
sum(is.na(cases$Weight_Kg))
```

```{r}
range(cases$Weight_Kg, na.rm = T)
```

```{r}
ggplot(cases, aes(Weight_Kg)) + geom_density()
```

There are 16 cases with no Weight information.

### Smoking:

```{r}
table(cases$Smoking, useNA = "always")
```

There are 12 cases with no smoking information.

```{r}
table(controls$Smoking, useNA = "always")
```

There are 7 controls with no smoking information.

## Diseases

### Hypertension:

```{r}
table(bio$hypertension, bio$Status, useNA = "always")
```

There are 19 NAs.

### Dyslipedmia:

```{r}
table(bio$dyslipidemia, bio$Status, useNA = "always")
```

There are 19 NAs.

### Diabetes mellitus:

```{r}
table(bio$diabetes.mellitus, bio$Status, useNA = "always")
```

There are 19 NAs.

```{r}
if(identical(bio[is.na(bio$hypertension),]$Muestra, bio[is.na(bio$dyslipidemia),]$Muestra) == TRUE & identical(bio[is.na(bio$dyslipidemia),]$Muestra, bio[is.na(bio$diabetes.mellitus),]$Muestra) == TRUE){
  print("The 19 samples with NAs are the same for Hypertension, Dyslipedmia and Diabetes Mellitus")}
```

### PAD (only Cases):

```{r}
table(cases$PAD, useNA = "always")
```

There are 13 NAs among cases.

### Other Aneurysm (only cases):

```{r}
table(cases$other_aneurysm, useNA = "always")
```

There are 12 NAs among cases.

### CVE:

```{r}
table(bio$CVE, bio$Status, useNA = "always")
```

There are 21 NAs.

### CVD:

```{r}
table(bio$CVD, bio$Status, useNA = "always")
```

### COPD:

```{r}
table(bio$COPD, bio$Status, useNA = "always")
```

### Kidney Disease:

```{r}
table(bio$kidney_disease, bio$Status, useNA = "always")
```

### Aortic Diameter:

```{r}
ggplot(cases, aes(aortc_diameter_mm)) + geom_density()
```

There are 12 cases with NAs diameter.

```{r}
nrow(cases[cases$aortc_diameter_mm > 55,])
nrow(cases[cases$aortc_diameter_mm < 55,])
```

```{r}
range(cases$aortc_diameter_mm, na.rm = T)
```
















